<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ°ç†çµ±è¨ˆã‚¯ã‚¤ã‚º</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    .header { text-align:center; margin-bottom:10px; }
    .header .title { font-size:1.8rem; font-weight:bold; }
    .header .version { font-size:1rem; color:#555; }

    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
    h1 { font-size: 1.5rem; text-align: center; }

    .tabs { display: flex; justify-content: space-around; margin-bottom: 15px; }
    .tab { flex: 1; font-size: 0.8rem; padding: 8px; border: none; background: #aad6f7; border-radius: 6px; text-align:center; display:flex; align-items:center; justify-content:center; }
    .tab.energy { font-size:10px; }
    .tab.active { background: #007aff; color: white; }

    button.main { width: 100%; padding: 14px; margin-top: 15px; font-size: 1.1rem; border: none; border-radius: 8px; background: #007aff; color: white; }
    button.small { width: 100%; padding: 10px; margin-top: 10px; font-size: 1.05rem; border: none; border-radius: 8px; }
    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
  </style>
</head>
<body>

  <div class="header">
    <div class="title">åœ°ç†çµ±è¨ˆã‚¯ã‚¤ã‚º</div>
    <div class="version">v0.1.0Î±</div>
  </div>

  <div class="card">

    <div class="tabs">
      <div class="tab" data-genre="agri">è¾²æ—æ°´ç”£æ¥­</div>
      <div class="tab energy" data-genre="energy">ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»é‰±å·¥æ¥­</div>
      <div class="tab" data-genre="other">ãã®ä»–</div>
    </div>

    <h1 id="quiz-title">å°éº¦<span style="font-size:0.8em; vertical-align:bottom;">ã®</span>è¼¸å‡ºé‡<span id="quiz-year" style="font-size:0.8em; vertical-align:bottom;">(2023)</span></h1>

    <p id="instruction">1ä½ â†’ 2ä½ â†’ 3ä½ ã®é †ã§å›½ã‚’é¸ã‚“ã§ãã ã•ã„</p>

    <div id="streak" style="text-align:right; font-size:0.9rem; margin-top:-10px; color:#ff9933;"></div>

    <div id="choices"></div>

    <div id="answerBlock" style="margin-top: 20px; display:block;">
      <strong>ã‚ãªãŸã®å›ç­”:</strong>
      <ol id="answers"></ol>
    </div>

    <button id="checkBtn" class="main" onclick="checkAnswer()" style="background:#aaa;" disabled>ç¢ºå®š</button>
    <button id="newQuizBtn" class="small" onclick="newQuiz(true)" style="display:none; background:#28a745; color:white;">æ–°ã—ã„å•é¡Œ</button>
  </div>

  <script>
    const quizSets = {
      agri: [
        { title:"å°éº¦ã®è¼¸å‡ºé‡", year:"2023", choices:["ã‚¢ãƒ¡ãƒªã‚«","ã‚«ãƒŠãƒ€","ãƒ•ãƒ©ãƒ³ã‚¹","ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢","ãƒ­ã‚·ã‚¢","ã‚¢ãƒ«ã‚¼ãƒ³ãƒãƒ³","ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠ","ã‚¤ãƒ³ãƒ‰","ãƒ‰ã‚¤ãƒ„","ä¸­å›½"], answer:["ãƒ­ã‚·ã‚¢","ã‚«ãƒŠãƒ€","ã‚¢ãƒ¡ãƒªã‚«"], comment:"ãƒ­ã‚·ã‚¢ãŒæœ€å¤§ã§ã™ã€‚" },
        { title:"ç±³ã®ç”Ÿç”£é‡", year:"2022", choices:["ä¸­å›½","ã‚¤ãƒ³ãƒ‰","ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢","ãƒãƒ³ã‚°ãƒ©ãƒ‡ã‚·ãƒ¥","ãƒ™ãƒˆãƒŠãƒ ","ã‚¿ã‚¤","æ—¥æœ¬","éŸ“å›½","ãƒ–ãƒ©ã‚¸ãƒ«","ãƒŸãƒ£ãƒ³ãƒãƒ¼"], answer:["ä¸­å›½","ã‚¤ãƒ³ãƒ‰","ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢"], comment:"ã‚¢ã‚¸ã‚¢ãŒå¤šã„ã§ã™ã€‚" }
      ],
      energy: [
        { title:"çŸ³æ²¹ã®ç”Ÿç”£é‡", year:"2023", choices:["ã‚¢ãƒ¡ãƒªã‚«","ã‚µã‚¦ã‚¸ã‚¢ãƒ©ãƒ“ã‚¢","ãƒ­ã‚·ã‚¢","ã‚«ãƒŠãƒ€","ã‚¤ãƒ©ã‚¯","UAE","ä¸­å›½","ã‚¤ãƒ©ãƒ³","ãƒ–ãƒ©ã‚¸ãƒ«","ã‚¯ã‚¦ã‚§ãƒ¼ãƒˆ"], answer:["ã‚¢ãƒ¡ãƒªã‚«","ã‚µã‚¦ã‚¸ã‚¢ãƒ©ãƒ“ã‚¢","ãƒ­ã‚·ã‚¢"], comment:"ã‚¢ãƒ¡ãƒªã‚«ãŒãƒˆãƒƒãƒ—ã€‚" },
        { title:"é‰„é‰±çŸ³ã®ç”Ÿç”£é‡", year:"2023", choices:["ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢","ãƒ–ãƒ©ã‚¸ãƒ«","ä¸­å›½","ã‚¤ãƒ³ãƒ‰","ãƒ­ã‚·ã‚¢","å—ã‚¢ãƒ•ãƒªã‚«","ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠ","ã‚«ãƒŠãƒ€","ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³","ã‚¤ãƒ©ãƒ³"], answer:["ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢","ãƒ–ãƒ©ã‚¸ãƒ«","ä¸­å›½"], comment:"ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ãŒä¸€ç•ªã§ã™ã€‚" }
      ],
      other: [
        { title:"è¦³å…‰å®¢æ•°ï¼ˆå›½åˆ¥ï¼‰", year:"2023", choices:["ãƒ•ãƒ©ãƒ³ã‚¹","ã‚¹ãƒšã‚¤ãƒ³","ã‚¢ãƒ¡ãƒªã‚«","ä¸­å›½","ã‚¤ã‚¿ãƒªã‚¢","ãƒˆãƒ«ã‚³","ãƒ¡ã‚­ã‚·ã‚³","ãƒ‰ã‚¤ãƒ„","è‹±å›½","ã‚¿ã‚¤"], answer:["ãƒ•ãƒ©ãƒ³ã‚¹","ã‚¹ãƒšã‚¤ãƒ³","ã‚¢ãƒ¡ãƒªã‚«"], comment:"ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘äººæ°—ã€‚" },
        { title:"ã‚¹ãƒãƒ›æ™®åŠç‡", year:"2023", choices:["éŸ“å›½","UAE","ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«","å°æ¹¾","æ—¥æœ¬","ã‚¢ãƒ¡ãƒªã‚«","è‹±å›½","ä¸­å›½","ã‚«ãƒŠãƒ€","ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢"], answer:["éŸ“å›½","UAE","ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«"], comment:"ã‚¢ã‚¸ã‚¢ãŒä¸Šä½ã€‚" }
      ]
    };

    let currentGenre = "agri";
    let currentQuiz = null;
    let userAnswers = [];
    let streak = 0;
    let currentQuizPerGenre = {};
    let previousQuizPerGenre = {};

    function shuffle(arr) {
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function updateStreak() {
      const s = document.getElementById('streak');
      s.textContent = streak>=1?`ğŸ¯ ${streak}å•é€£ç¶šæ­£è§£ï¼`:"";
    }

    function newQuiz(fromButton=false) {
      const old = document.getElementById('result');
      if(old) old.remove();
      const oldComment = document.getElementById('commentBlock');
      if(oldComment) oldComment.remove();

      userAnswers=[]; 
      document.getElementById('answers').innerHTML='';
      document.getElementById('answerBlock').style.display='block';
      document.getElementById('choices').style.display='grid';
      document.getElementById('instruction').style.display='block';
      document.getElementById('checkBtn').disabled = true;
      document.getElementById('checkBtn').style.background = '#aaa';
      document.getElementById('checkBtn').style.display='block';
      document.getElementById('newQuizBtn').style.display='none';

      const set = quizSets[currentGenre];
      let candidateSet = set.slice();

      if(fromButton && previousQuizPerGenre[currentGenre]){
        candidateSet = candidateSet.filter(q => q !== previousQuizPerGenre[currentGenre]);
      }

      if(!currentQuizPerGenre[currentGenre] || fromButton){
        currentQuizPerGenre[currentGenre] = candidateSet[Math.floor(Math.random()*candidateSet.length)];
      }

      currentQuiz = currentQuizPerGenre[currentGenre];
      previousQuizPerGenre[currentGenre] = currentQuiz;
      document.getElementById('quiz-title').innerHTML = currentQuiz.title.replace('ã®', '<span style="font-size:0.8em; vertical-align:bottom;">ã®</span>') +
        `<span id="quiz-year" style="font-size:0.8em; vertical-align:bottom;">(${currentQuiz.year})</span>`;

      const box = document.getElementById('choices');
      box.innerHTML='';
      shuffle(currentQuiz.choices).forEach(name=>{
        const btn=document.createElement('button');
        btn.textContent=name;
        btn.className='small';
        btn.style.background='#00aaff';
        btn.style.color='white';
        btn.style.borderRadius='8px';
        btn.style.fontSize='1.05rem';
        btn.addEventListener('click',()=>toggleSelect(name,btn));
        box.appendChild(btn);
      });
    }

    function toggleSelect(name, btn){
      const idx=userAnswers.indexOf(name);
      if(idx!==-1){
        userAnswers.splice(idx,1);
        btn.style.background='#00aaff';
        btn.style.color='white';
      }else{
        if(userAnswers.length>=3) return;
        userAnswers.push(name);
        btn.style.background='#a0e7ff';
        btn.style.color='#333';
      }
      const list=document.getElementById('answers');
      list.innerHTML='';
      userAnswers.forEach(a=>{
        const li=document.createElement('li');
        li.textContent=a;
        list.appendChild(li);
      });
      const checkBtn=document.getElementById('checkBtn');
      if(userAnswers.length===3){
        checkBtn.disabled=false;
        checkBtn.style.background='#28a745';
      }else{
        checkBtn.disabled=true;
        checkBtn.style.background='#aaa';
      }
    }

    function checkAnswer(){
      const correct=currentQuiz.answer;
      document.getElementById('answerBlock').style.display='none';
      document.getElementById('choices').style.display='none';
      document.getElementById('instruction').style.display='none';
      document.getElementById('checkBtn').style.display='none';

      let allCorrect=true;
      for(let i=0;i<3;i++){
        if(correct[i]!==userAnswers[i]) allCorrect=false;
      }
      streak=allCorrect?streak+1:0;
      updateStreak();

      const result=document.createElement('div');
      result.id='result';
      result.style.marginTop='10px';
      result.style.background='#eef';
      result.style.padding='10px';
      result.style.borderRadius='8px';
      let html='<strong>çµæœ:</strong><br>';
      for(let i=0;i<3;i++){
        const ok=userAnswers[i]===correct[i];
        const icon=ok?'â­•':'âŒ';
        const color=ok?'#28a745':'#d00';
        html+=`${icon} ${i+1}ä½ â†’ <span style='color:${color}'>ã‚ãªãŸ: ${userAnswers[i]||'-'} / æ­£è§£: ${correct[i]}</span><br>`;
      }
      result.innerHTML=html;
      document.querySelector('.card').appendChild(result);

      let lastElement = result;
      if(currentQuiz.comment && currentQuiz.comment.trim()!==""){
        const commentDiv=document.createElement('div');
        commentDiv.id='commentBlock';
        commentDiv.style.margin='10px 0';
        commentDiv.style.background='#ffe';
        commentDiv.style.padding='10px';
        commentDiv.style.borderRadius='8px';
        commentDiv.innerHTML=`<strong>ã²ã¨ã“ã¨:</strong><br>${currentQuiz.comment}`;
        document.querySelector('.card').appendChild(commentDiv);
        lastElement = commentDiv;
      }

      const newBtn=document.getElementById('newQuizBtn');
      newBtn.style.display='block';
      document.querySelector('.card').appendChild(newBtn);
    }

    document.querySelectorAll('.tab').forEach(tab=>{
      tab.addEventListener('click',()=>{
        const genre = tab.dataset.genre;
        if(currentGenre===genre && currentQuizPerGenre[genre]) return;
        currentGenre=genre;
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        newQuiz();
      });
    });

    document.querySelector('.tab[data-genre="'+currentGenre+'"]').classList.add('active');
    newQuiz();
  </script>
</body>
</html>
